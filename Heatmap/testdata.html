
<!DOCTYPE html>
<meta charset="utf-8">
<style>
</style>
<body>
<script src="http://d3js.org/d3.v3.js"></script>
<script src="data.js"></script>
    
<script>

// _data is defined in data[_small].js
console.log(_data);

// getting points from _data json object
var points = _data.points;
console.log(points);

var marker_names = _data.names;
var cluster_names = [];
for (var i = 0; i < points.length; i++)
{
    if(!cluster_names.includes("cluster" + points[i].clusterID))
        cluster_names.push("cluster" + points[i].clusterID);
}

var cluster_marker_matrix = [];
for (var i = 0; i < cluster_names.length; i++)
{
    cluster_marker_matrix[i] = [];
    for (var j = 0; j < marker_names.length; j++)
    {
        cluster_marker_matrix[i][j] = [];
    }
}
for (var i = 0; i < points.length; i++)
{
    for(var j = 0; j < points[i].expression.length; j++)
    {
        var cluster_index = cluster_names.indexOf("cluster"+points[i].clusterID);
        cluster_marker_matrix[cluster_index][j].push(points[i].expression[j]);
    }
}
console.log(cluster_marker_matrix);
var variance_matrix = [],
    mean_matrix = [];
for (var i = 0; i < cluster_names.length; i++)
{
    variance_matrix[i] = [];
    mean_matrix[i] = [];
    for (var j = 0; j < marker_names.length; j++)
    {
        variance_matrix[i][j] = [];
        mean_matrix[i][j] = [];
        variance_matrix[i][j].push(d3.deviation(cluster_marker_matrix[i][j]), j)
        mean_matrix[i][j].push(d3.mean(cluster_marker_matrix[i][j]), j);
    }
}
var data = [];
for (var i = 0; i < cluster_names.length; i++)
{
  for (var j = 0; j < marker_names.length; j++)
  {
    data.push({
      dim1: (j + 1),
      dim2: (i + 1),
      mean: mean_matrix[i][j],
      variance: variance_matrix[i][j]

    });
  }
}
// console.log(variance_matrix);
// console.log(mean_matrix);    
console.log(data);
</script>
